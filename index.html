<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈÖ∑ÁÇ´È£ûÊú∫Â§ßÊàò</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000;
            overflow: hidden;
            touch-action: none;
            position: relative;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #000533, #000);
            overflow: hidden;
        }
        
        #game-canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 40px 60px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 20px 120px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 100px 20px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 120px 130px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 150px 180px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 220px 80px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 180px 50px, #fff, rgba(0,0,0,0));
            background-repeat: repeat;
            background-size: 250px 250px;
            animation: animateStars 10s linear infinite;
        }
        
        @keyframes animateStars {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(250px);
            }
        }
        
        #ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        #score-container {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: #fff;
            text-shadow: 0 0 10px #0ff;
        }
        
        #health-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
        }
        
        .health-point {
            width: 30px;
            height: 30px;
            margin-left: 5px;
            background-color: #f00;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            box-shadow: 0 0 10px #f00;
        }
        
        #bullets-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }
        
        #bullets-icon {
            width: 30px;
            height: 20px;
            margin-right: 10px;
            background-color: #ff0;
            border-radius: 3px;
            box-shadow: 0 0 10px #ff0;
        }
        
        #bullets-count {
            font-size: 24px;
            color: #fff;
            text-shadow: 0 0 10px #ff0;
        }
        
        #game-start {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #0ff;
            color: #0ff;
            font-size: 24px;
            padding: 20px 40px;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 0 20px #0ff;
            pointer-events: auto;
            transition: all 0.3s ease;
        }
        
        #game-start:hover {
            background: rgba(0, 0, 0, 0.9);
            box-shadow: 0 0 30px #0ff;
        }
        
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #f00;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            box-shadow: 0 0 30px #f00;
        }
        
        #game-over h2 {
            color: #f00;
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #f00;
        }
        
        #final-score {
            color: #fff;
            font-size: 24px;
            margin-bottom: 30px;
        }
        
        #restart-button {
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid #f00;
            color: #fff;
            font-size: 20px;
            padding: 10px 30px;
            border-radius: 5px;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s ease;
        }
        
        #restart-button:hover {
            background: rgba(255, 0, 0, 0.6);
            box-shadow: 0 0 15px #f00;
        }
        
        .power-up {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: radial-gradient(circle, #ff0, #fa0);
            box-shadow: 0 0 15px #ff0;
            animation: powerUpPulse 1s infinite alternate;
        }
        
        @keyframes powerUpPulse {
            from {
                box-shadow: 0 0 15px #ff0;
            }
            to {
                box-shadow: 0 0 25px #ff0;
            }
        }
        
        #level-indicator {
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-size: 20px;
            color: #fff;
            text-shadow: 0 0 10px #0ff;
        }
        
        #controls {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            pointer-events: auto;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            background: rgba(0, 255, 255, 0.2);
            border: 2px solid #0ff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #0ff;
            font-size: 24px;
            box-shadow: 0 0 10px #0ff;
        }
        
        #shoot-btn {
            background: rgba(255, 0, 0, 0.2);
            border-color: #f00;
            color: #f00;
            box-shadow: 0 0 10px #f00;
        }
        
        @media (min-width: 768px) {
            #controls {
                display: none;
            }
        }
        
        .explosion {
            position: absolute;
            pointer-events: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, #ff0, #f00);
            transform: scale(0);
            opacity: 1;
            animation: explode 0.5s ease-out forwards;
        }
        
        @keyframes explode {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="stars"></div>
        <canvas id="game-canvas"></canvas>
        
        <div id="ui-container">
            <div id="score-container">ÂàÜÊï∞: <span id="score">0</span></div>
            <div id="health-container">
                <div class="health-point"></div>
                <div class="health-point"></div>
                <div class="health-point"></div>
            </div>
            <div id="bullets-container">
                <div id="bullets-icon"></div>
                <div id="bullets-count">‚àû</div>
            </div>
            <div id="level-indicator">Á∫ßÂà´: <span id="level">1</span></div>
            
            <button id="game-start">ÂºÄÂßãÊ∏∏Êàè</button>
            
            <div id="game-over">
                <h2>Ê∏∏ÊàèÁªìÊùü</h2>
                <div id="final-score">ÊúÄÁªàÂàÜÊï∞: 0</div>
                <button id="restart-button">ÈáçÊñ∞ÂºÄÂßã</button>
            </div>
            
            <div id="controls">
                <div class="control-btn" id="left-btn">‚Üê</div>
                <div class="control-btn" id="right-btn">‚Üí</div>
                <div class="control-btn" id="shoot-btn">üî•</div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const gameContainer = document.getElementById('game-container');
            const startButton = document.getElementById('game-start');
            const gameOverScreen = document.getElementById('game-over');
            const restartButton = document.getElementById('restart-button');
            const scoreElement = document.getElementById('score');
            const finalScoreElement = document.getElementById('final-score');
            const healthContainer = document.getElementById('health-container');
            const levelElement = document.getElementById('level');
            const leftBtn = document.getElementById('left-btn');
            const rightBtn = document.getElementById('right-btn');
            const shootBtn = document.getElementById('shoot-btn');
            
            // Ê∏∏ÊàèÁä∂ÊÄÅ
            let gameRunning = false;
            let score = 0;
            let health = 3;
            let level = 1;
            let enemySpeed = 2;
            let enemySpawnRate = 1500;
            let lastEnemySpawn = 0;
            let lastPowerUpSpawn = 0;
            let powerUpChance = 0.05;
            
            // Áé©ÂÆ∂
            const player = {
                x: 0,
                y: 0,
                width: 60,
                height: 60,
                speed: 8,
                shooting: false,
                lastShot: 0,
                shotDelay: 200,
                powerUp: 1
            };
            
            // Ê∏∏ÊàèÂØπË±°
            let bullets = [];
            let enemies = [];
            let powerUps = [];
            let particles = [];
            
            // ÊéßÂà∂Áä∂ÊÄÅ
            const keys = {
                ArrowLeft: false,
                ArrowRight: false,
                Space: false
            };
            
            // Ëß¶Êë∏ÊéßÂà∂Áä∂ÊÄÅ
            let touchLeft = false;
            let touchRight = false;
            let touchShoot = false;
            
            // ÂàùÂßãÂåñÁîªÂ∏ÉÂ§ßÂ∞è
            function resizeCanvas() {
                canvas.width = gameContainer.clientWidth;
                canvas.height = gameContainer.clientHeight;
                
                // ÈáçÊñ∞ÂÆö‰ΩçÁé©ÂÆ∂
                if (player) {
                    player.x = canvas.width / 2 - player.width / 2;
                    player.y = canvas.height - player.height - 20;
                }
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            // ÈîÆÁõòÊéßÂà∂
            window.addEventListener('keydown', (e) => {
                if (e.key in keys) {
                    keys[e.key] = true;
                    e.preventDefault();
                }
            });
            
            window.addEventListener('keyup', (e) => {
                if (e.key in keys) {
                    keys[e.key] = false;
                    e.preventDefault();
                }
            });
            
            // Ëß¶Êë∏ÊéßÂà∂
            leftBtn.addEventListener('touchstart', () => touchLeft = true);
            leftBtn.addEventListener('touchend', () => touchLeft = false);
            leftBtn.addEventListener('mousedown', () => touchLeft = true);
            leftBtn.addEventListener('mouseup', () => touchLeft = false);
            
            rightBtn.addEventListener('touchstart', () => touchRight = true);
            rightBtn.addEventListener('touchend', () => touchRight = false);
            rightBtn.addEventListener('mousedown', () => touchRight = true);
            rightBtn.addEventListener('mouseup', () => touchRight = false);
            
            shootBtn.addEventListener('touchstart', () => touchShoot = true);
            shootBtn.addEventListener('touchend', () => touchShoot = false);
            shootBtn.addEventListener('mousedown', () => touchShoot = true);
            shootBtn.addEventListener('mouseup', () => touchShoot = false);
            
            // ÂºÄÂßãÊ∏∏Êàè
            startButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', startGame);
            
            function startGame() {
                gameRunning = true;
                score = 0;
                health = 3;
                level = 1;
                enemySpeed = 2;
                enemySpawnRate = 1500;
                player.powerUp = 1;
                
                // ÈáçÁΩÆUI
                scoreElement.textContent = '0';
                updateHealthUI();
                levelElement.textContent = '1';
                
                // ÈáçÁΩÆÊ∏∏ÊàèÂØπË±°
                bullets = [];
                enemies = [];
                powerUps = [];
                particles = [];
                
                // ÈáçÊñ∞ÂÆö‰ΩçÁé©ÂÆ∂
                player.x = canvas.width / 2 - player.width / 2;
                player.y = canvas.height - player.height - 20;
                
                // ÈöêËóèÂºÄÂßãÁïåÈù¢
                startButton.style.display = 'none';
                gameOverScreen.style.display = 'none';
                
                // ÂºÄÂßãÊ∏∏ÊàèÂæ™ÁéØ
                if (!gameLoop) {
                    gameLoop = requestAnimationFrame(update);
                }
            }
            
            function gameOver() {
                gameRunning = false;
                finalScoreElement.textContent = `ÊúÄÁªàÂàÜÊï∞: ${score}`;
                gameOverScreen.style.display = 'block';
                cancelAnimationFrame(gameLoop);
                gameLoop = null;
            }
            
            function updateHealthUI() {
                // Êõ¥Êñ∞ÁîüÂëΩÂÄºUI
                const healthPoints = healthContainer.querySelectorAll('.health-point');
                for (let i = 0; i < healthPoints.length; i++) {
                    if (i < health) {
                        healthPoints[i].style.opacity = '1';
                    } else {
                        healthPoints[i].style.opacity = '0.3';
                    }
                }
            }
            
            // Á¢∞ÊíûÊ£ÄÊµã
            function checkCollision(obj1, obj2) {
                return (
                    obj1.x < obj2.x + obj2.width &&
                    obj1.x + obj1.width > obj2.x &&
                    obj1.y < obj2.y + obj2.height &&
                    obj1.y + obj1.height > obj2.y
                );
            }
            
            // ÁîüÊàêÊïå‰∫∫
            function spawnEnemy(timestamp) {
                if (timestamp - lastEnemySpawn > enemySpawnRate) {
                    const width = 50;
                    const x = Math.random() * (canvas.width - width);
                    
                    enemies.push({
                        x,
                        y: -50,
                        width,
                        height: 50,
                        speed: enemySpeed + Math.random(),
                        health: Math.ceil(level / 3)
                    });
                    
                    lastEnemySpawn = timestamp;
                }
            }
            
            // ÁîüÊàêËÉΩÈáèÈÅìÂÖ∑
            function spawnPowerUp(timestamp) {
                if (timestamp - lastPowerUpSpawn > 10000 && Math.random() < powerUpChance) {
                    const size = 30;
                    const x = Math.random() * (canvas.width - size);
                    
                    powerUps.push({
                        x,
                        y: -size,
                        width: size,
                        height: size,
                        speed: 2,
                        type: Math.random() < 0.7 ? 'weapon' : 'health'
                    });
                    
                    lastPowerUpSpawn = timestamp;
                }
            }
            
            // ÂàõÂª∫ÁàÜÁÇ∏ÊïàÊûú
            function createExplosion(x, y) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.style.left = `${x}px`;
                explosion.style.top = `${y}px`;
                gameContainer.appendChild(explosion);
                
                setTimeout(() => {
                    explosion.remove();
                }, 500);
                
                // ÂàõÂª∫Á≤íÂ≠êÊïàÊûú
                for (let i = 0; i < 10; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 1 + Math.random() * 3;
                    
                    particles.push({
                        x: x + 25,
                        y: y + 25,
                        radius: 3 + Math.random() * 5,
                        color: `hsl(${Math.random() * 60 + 10}, 100%, 50%)`,
                        velocityX: Math.cos(angle) * speed,
                        velocityY: Math.sin(angle) * speed,
                        life: 60
                    });
                }
            }
            
            // Ê∏≤ÊüìÁé©ÂÆ∂È£ûÊú∫
            function drawPlayer() {
                ctx.save();
                
                // Êú∫Ë∫´
                ctx.fillStyle = '#0af';
                ctx.beginPath();
                ctx.moveTo(player.x + player.width / 2, player.y);
                ctx.lineTo(player.x + player.width, player.y + player.height);
                ctx.lineTo(player.x, player.y + player.height);
                ctx.closePath();
                ctx.fill();
                
                // Êú∫Áøº
                ctx.fillStyle = '#08f';
                ctx.beginPath();
                ctx.moveTo(player.x, player.y + player.height * 0.6);
                ctx.lineTo(player.x - player.width * 0.2, player.y + player.height * 0.8);
                ctx.lineTo(player.x, player.y + player.height * 0.8);
                ctx.closePath();
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(player.x + player.width, player.y + player.height * 0.6);
                ctx.lineTo(player.x + player.width * 1.2, player.y + player.height * 0.8);
                ctx.lineTo(player.x + player.width, player.y + player.height * 0.8);
                ctx.closePath();
                ctx.fill();
                
                // ÂºïÊìéÁÅ´ÁÑ∞
                ctx.fillStyle = '#f50';
                ctx.beginPath();
                ctx.moveTo(player.x + player.width * 0.3, player.y + player.height);
                ctx.lineTo(player.x + player.width * 0.5, player.y + player.height + 15 + Math.random() * 10);
                ctx.lineTo(player.x + player.width * 0.7, player.y + player.height);
                ctx.closePath();
                ctx.fill();
                
                // È£ûÊú∫ÂèëÂÖâÊïàÊûú
                ctx.shadowColor = '#0ff';
                ctx.shadowBlur = 10;
                ctx.strokeStyle = '#0ff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(player.x + player.width / 2, player.y);
                ctx.lineTo(player.x + player.width, player.y + player.height);
                ctx.lineTo(player.x, player.y + player.height);
                ctx.closePath();
                ctx.stroke();
                
                ctx.restore();
            }
            
            // Ê∏≤ÊüìÂ≠êÂºπ
            function drawBullets() {
                ctx.save();
                
                bullets.forEach(bullet => {
                    ctx.fillStyle = bullet.powered ? '#ff0' : '#f00';
                    ctx.shadowColor = bullet.powered ? '#ff0' : '#f00';
                    ctx.shadowBlur = 10;
                    ctx.beginPath();
                    ctx.rect(bullet.x, bullet.y, bullet.width, bullet.height);
                    ctx.fill();
                });
                
                ctx.restore();
            }
            
            // Ê∏≤ÊüìÊïå‰∫∫
            function drawEnemies() {
                ctx.save();
                
                enemies.forEach(enemy => {
                    // ÊïåÊú∫Ë∫´‰Ωì
                    ctx.fillStyle = '#f00';
                    ctx.beginPath();
                    ctx.moveTo(enemy.x + enemy.width / 2, enemy.y + enemy.height);
                    ctx.lineTo(enemy.x + enemy.width, enemy.y);
                    ctx.lineTo(enemy.x, enemy.y);
                    ctx.closePath();
                    ctx.fill();
                    
                    // ÊïåÊú∫Áøº
                    ctx.fillStyle = '#900';
                    ctx.beginPath();
                    ctx.moveTo(enemy.x, enemy.y + enemy.height * 0.3);
                    ctx.lineTo(enemy.x - enemy.width * 0.3, enemy.y + enemy.height * 0.1);
                    ctx.lineTo(enemy.x, enemy.y + enemy.height * 0.1);
                    ctx.closePath();
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.moveTo(enemy.x + enemy.width, enemy.y + enemy.height * 0.3);
                    ctx.lineTo(enemy.x + enemy.width * 1.3, enemy.y + enemy.height * 0.1);
                    ctx.lineTo(enemy.x + enemy.width, enemy.y + enemy.height * 0.1);
                    ctx.closePath();
                    ctx.fill();
                    
                    // ÊïåÊú∫ÂèëÂÖâÊïàÊûú
                    ctx.shadowColor = '#f00';
                    ctx.shadowBlur = 10;
                    ctx.strokeStyle = '#f00';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(enemy.x + enemy.width / 2, enemy.y + enemy.height);
                    ctx.lineTo(enemy.x + enemy.width, enemy.y);
                    ctx.lineTo(enemy.x, enemy.y);
                    ctx.closePath();
                    ctx.stroke();
                });
                
                ctx.restore();
            }
            
            // Ê∏≤ÊüìËÉΩÈáèÈÅìÂÖ∑
            function drawPowerUps() {
                ctx.save();
                
                powerUps.forEach(powerUp => {
                    const gradient = ctx.createRadialGradient(
                        powerUp.x + powerUp.width / 2,
                        powerUp.y + powerUp.height / 2,
                        0,
                        powerUp.x + powerUp.width / 2,
                        powerUp.y + powerUp.height / 2,
                        powerUp.width / 2
                    );
                    
                    if (powerUp.type === 'weapon') {
                        gradient.addColorStop(0, '#ff0');
                        gradient.addColorStop(1, '#fa0');
                        ctx.shadowColor = '#ff0';
                    } else {
                        gradient.addColorStop(0, '#0f0');
                        gradient.addColorStop(1, '#0a0');
                        ctx.shadowColor = '#0f0';
                    }
                    
                    ctx.shadowBlur = 15;
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(
                        powerUp.x + powerUp.width / 2,
                        powerUp.y + powerUp.height / 2,
                        powerUp.width / 2,
                        0,
                        Math.PI * 2
                    );
                    ctx.fill();
                    
                    // ÂÜÖÈÉ®ÂõæÊ†á
                    ctx.fillStyle = '#fff';
                    if (powerUp.type === 'weapon') {
                        ctx.beginPath();
                        ctx.moveTo(powerUp.x + powerUp.width * 0.3, powerUp.y + powerUp.height * 0.3);
                        ctx.lineTo(powerUp.x + powerUp.width * 0.7, powerUp.y + powerUp.height * 0.3);
                        ctx.lineTo(powerUp.x + powerUp.width * 0.7, powerUp.y + powerUp.height * 0.7);
                        ctx.lineTo(powerUp.x + powerUp.width * 0.3, powerUp.y + powerUp.height * 0.7);
                        ctx.closePath();
                        ctx.fill();
                    } else {
                        ctx.beginPath();
                        ctx.moveTo(powerUp.x + powerUp.width * 0.5, powerUp.y + powerUp.height * 0.3);
                        ctx.lineTo(powerUp.x + powerUp.width * 0.7, powerUp.y + powerUp.height * 0.5);
                        ctx.lineTo(powerUp.x + powerUp.width * 0.5, powerUp.y + powerUp.height * 0.7);
                        ctx.lineTo(powerUp.x + powerUp.width * 0.3, powerUp.y + powerUp.height * 0.5);
                        ctx.closePath();
                        ctx.fill();
                    }
                });
                
                ctx.restore();
            }
            
            // Ê∏≤ÊüìÁ≤íÂ≠ê
            function drawParticles() {
                ctx.save();
                
                particles.forEach(particle => {
                    ctx.globalAlpha = particle.life / 60;
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                ctx.restore();
            }
            
            // ÂèëÂ∞ÑÂ≠êÂºπ
            function fireBullet() {
                const now = Date.now();
                if (now - player.lastShot > player.shotDelay) {
                    // Ê†πÊçÆÂº∫ÂåñÁ≠âÁ∫ßÂÜ≥ÂÆöÂèëÂ∞ÑÁöÑÂ≠êÂºπ
                    if (player.powerUp === 1) {
                        // ÂçïÂèëÂ≠êÂºπ
                        bullets.push({
                            x: player.x + player.width / 2 - 2.5,
                            y: player.y,
                            width: 5,
                            height: 15,
                            speed: 10,
                            powered: false
                        });
                    } else if (player.powerUp === 2) {
                        // ÂèåÂèëÂ≠êÂºπ
                        bullets.push({
                            x: player.x + player.width / 3 - 2.5,
                            y: player.y + 10,
                            width: 5,
                            height: 15,
                            speed: 10,
                            powered: false
                        });
                        
                        bullets.push({
                            x: player.x + player.width * 2/3 - 2.5,
                            y: player.y + 10,
                            width: 5,
                            height: 15,
                            speed: 10,
                            powered: false
                        });
                    } else {
                        // ‰∏âÂèëÂ≠êÂºπÔºå‰∏≠Èó¥‰∏∫Âº∫ÂåñÂ≠êÂºπ
                        bullets.push({
                            x: player.x + player.width / 4 - 2.5,
                            y: player.y + 10,
                            width: 5,
                            height: 15,
                            speed: 10,
                            powered: false
                        });
                        
                        bullets.push({
                            x: player.x + player.width / 2 - 3,
                            y: player.y,
                            width: 6,
                            height: 20,
                            speed: 12,
                            powered: true
                        });
                        
                        bullets.push({
                            x: player.x + player.width * 3/4 - 2.5,
                            y: player.y + 10,
                            width: 5,
                            height: 15,
                            speed: 10,
                            powered: false
                        });
                    }
                    
                    player.lastShot = now;
                }
            }
            
            // Êõ¥Êñ∞Ê∏∏ÊàèÈÄªËæë
            function updateGameLogic(timestamp) {
                // Áé©ÂÆ∂ÁßªÂä®
                if ((keys.ArrowLeft || touchLeft) && player.x > 0) {
                    player.x -= player.speed;
                }
                
                if ((keys.ArrowRight || touchRight) && player.x + player.width < canvas.width) {
                    player.x += player.speed;
                }
                
                // Áé©ÂÆ∂Â∞ÑÂáª
                if (keys.Space || touchShoot) {
                    fireBullet();
                }
                
                // Êõ¥Êñ∞Â≠êÂºπ‰ΩçÁΩÆ
                bullets.forEach((bullet, index) => {
                    bullet.y -= bullet.speed;
                    
                    // ÁßªÈô§Ë∂ÖÂá∫Â±èÂπïÁöÑÂ≠êÂºπ
                    if (bullet.y + bullet.height < 0) {
                        bullets.splice(index, 1);
                    }
                });
                
                // ÁîüÊàêÊïå‰∫∫
                spawnEnemy(timestamp);
                
                // Êõ¥Êñ∞Êïå‰∫∫‰ΩçÁΩÆ
                enemies.forEach((enemy, enemyIndex) => {
                    enemy.y += enemy.speed;
                    
                    // Ê£ÄÊü•‰∏éÁé©ÂÆ∂ÁöÑÁ¢∞Êíû
                    if (checkCollision(player, enemy)) {
                        createExplosion(enemy.x, enemy.y);
                        enemies.splice(enemyIndex, 1);
                        health--;
                        updateHealthUI();
                        
                        if (health <= 0) {
                            gameOver();
                        }
                    }
                    
                    // Ê£ÄÊü•‰∏éÂ≠êÂºπÁöÑÁ¢∞Êíû
                    bullets.forEach((bullet, bulletIndex) => {
                        if (checkCollision(bullet, enemy)) {
                            bullets.splice(bulletIndex, 1);
                            
                            enemy.health--;
                            if (enemy.health <= 0) {
                                createExplosion(enemy.x, enemy.y);
                                enemies.splice(enemyIndex, 1);
                                score += 10;
                                scoreElement.textContent = score;
                                
                                // ÊØè100ÂàÜÂçáÁ∫ß‰∏ÄÊ¨°
                                if (score % 100 === 0) {
                                    levelUp();
                                }
                            }
                        }
                    });
                    
                    // ÁßªÈô§Ë∂ÖÂá∫Â±èÂπïÁöÑÊïå‰∫∫
                    if (enemy.y > canvas.height) {
                        enemies.splice(enemyIndex, 1);
                    }
                });
                
                // ÁîüÊàêËÉΩÈáèÈÅìÂÖ∑
                spawnPowerUp(timestamp);
                
                // Êõ¥Êñ∞ËÉΩÈáèÈÅìÂÖ∑‰ΩçÁΩÆ
                powerUps.forEach((powerUp, index) => {
                    powerUp.y += powerUp.speed;
                    
                    // Ê£ÄÊü•‰∏éÁé©ÂÆ∂ÁöÑÁ¢∞Êíû
                    if (checkCollision(player, powerUp)) {
                        if (powerUp.type === 'weapon') {
                            if (player.powerUp < 3) {
                                player.powerUp++;
                            }
                        } else {
                            if (health < 3) {
                                health++;
                                updateHealthUI();
                            } else {
                                score += 50;
                                scoreElement.textContent = score;
                            }
                        }
                        
                        powerUps.splice(index, 1);
                    }
                    
                    // ÁßªÈô§Ë∂ÖÂá∫Â±èÂπïÁöÑËÉΩÈáèÈÅìÂÖ∑
                    if (powerUp.y > canvas.height) {
                        powerUps.splice(index, 1);
                    }
                });
                
                // Êõ¥Êñ∞Á≤íÂ≠ê
                particles.forEach((particle, index) => {
                    particle.x += particle.velocityX;
                    particle.y += particle.velocityY;
                    particle.life--;
                    
                    if (particle.life <= 0) {
                        particles.splice(index, 1);
                    }
                });
            }
            
            // ÂçáÁ∫ßÊ∏∏ÊàèÈöæÂ∫¶
            function levelUp() {
                level++;
                levelElement.textContent = level;
                
                // Â¢ûÂä†Êïå‰∫∫ÈÄüÂ∫¶ÂíåÁîüÊàêÁéá
                enemySpeed += 0.3;
                enemySpawnRate = Math.max(300, enemySpawnRate - 100);
                
                // Â¢ûÂä†ËÉΩÈáèÈÅìÂÖ∑Âá∫Áé∞Áéá
                powerUpChance = Math.min(0.15, powerUpChance + 0.01);
            }
            
            // Ê∏∏Êàè‰∏ªÂæ™ÁéØ
            let gameLoop;
            function update(timestamp) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                if (gameRunning) {
                    updateGameLogic(timestamp);
                }
                
                // Ê∏≤ÊüìÊ∏∏ÊàèÂØπË±°
                drawPlayer();
                drawBullets();
                drawEnemies();
                drawPowerUps();
                drawParticles();
                
                gameLoop = requestAnimationFrame(update);
            }
            
            // ÊòæÁ§∫ÂºÄÂßãÁïåÈù¢
            startButton.style.display = 'block';
        });
    </script>
</body>
</html>
